name: Generate SBOM                     # Name des Workflows in GitHub Actions

on:                                     # Auslöser des Workflows
  pull_request:                         # läuft für Pull Requests
    types: [opened, synchronize, reopened]  # bei PR-Erstellung, weiteren Commits und Wiederöffnen

jobs:                                   # Definition der Jobs
  build:                                # Job-Name
    runs-on: ubuntu-latest              # Runner-Umgebung (Ubuntu)

    steps:                              # Auszuführende Schritte
      - name: Checkout code             # Repository auf den Runner ziehen
        uses: actions/checkout@v4

      - name: Set up Python             # Python-Toolchain bereitstellen
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'        # Python-Version für das Projekt

      - name: Install dependencies      # Projektabhängigkeiten installieren
        run: pip install -r requirements.txt  # liest requirements.txt (z.B. requests/pandas/numpy)

      - name: Generate SBOM             # SBOM mit Syft erzeugen
        uses: anchore/sbom-action/download-syft@v0.17.0
        with:
          format: cyclonedx-json        # Ausgabeformat: CycloneDX JSON (Datei: sbom.json)

      - name: Upload SBOM               # SBOM als Artefakt anhängen
        uses: actions/upload-artifact@v4
        with:
          name: sbom                    # Artefaktname in der Actions-Ansicht
          path: sbom.json               # Pfad zur erzeugten SBOM-Datei
