# Name des Workflows ‚Äì erscheint in GitHub unter "Actions"
name: Policy Enforcement

# Wann der Workflow starten soll
on:
  # Wird ausgel√∂st, wenn jemand einen Pull Request erstellt oder aktualisiert
  pull_request:
    # Wir reagieren nur auf bestimmte Aktionen am PR
    types: [opened, synchronize, reopened]

# Hier beginnen die Jobs (ein Workflow kann mehrere Jobs enthalten)
jobs:
  # Job-ID: frei w√§hlbarer Name (hier "enforce-policies")
  enforce-policies:
    # Laufzeitumgebung ‚Äì GitHub stellt eine Ubuntu-VM bereit
    runs-on: ubuntu-latest

    # Liste der einzelnen Schritte, die in diesem Job ausgef√ºhrt werden
    steps:
      # Schritt 1: Repository-Code in die VM laden
      - name: Checkout repository
        uses: actions/checkout@v4  # Offizielle GitHub-Action, l√§dt dein Repo

      # Schritt 2: Policy-Pr√ºfung
      - name: Check if PR targets main
        run: |  # Mehrzeiliges Shell-Skript
          echo "üîç Pr√ºfe Ziel-Branch..."

          # Zugriff auf PR-Daten √ºber GitHub-Kontext:
          # github.event.pull_request.base.ref = Ziel-Branch des PR
          if [ "${{ github.event.pull_request.base.ref }}" == "main" ]; then
            echo "‚ùå Merge in main ist nicht erlaubt!"
            exit 1  # Beende den Job mit Fehler ‚Üí GitHub zeigt roten Status ‚Üí Merge blockiert
          else
            echo "‚úÖ Merge-Ziel ist erlaubt."
          fi
