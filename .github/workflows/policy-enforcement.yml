# Name des Workflows â€“ erscheint in GitHub unter "Actions"
name: Policy Enforcement

# Wann der Workflow starten soll
on:
  # Wird ausgelÃ¶st, wenn jemand einen Pull Request erstellt oder aktualisiert
  pull_request:
    # Wir reagieren nur auf bestimmte Aktionen am PR
    types: [opened, synchronize, reopened]

# Hier beginnen die Jobs (ein Workflow kann mehrere Jobs enthalten)
jobs:
  # Job-ID: frei wÃ¤hlbarer Name (hier "enforce-policies")
  enforce-policies:
    # Laufzeitumgebung â€“ GitHub stellt eine Ubuntu-VM bereit
    runs-on: ubuntu-latest

    # Berechtigungen â€“ erlaubt dem Workflow, PRs zu lesen und Status zu setzen
    permissions:
      contents: read
      pull-requests: write

    # Liste der einzelnen Schritte, die in diesem Job ausgefÃ¼hrt werden
    steps:
      # Schritt 2: Policy-PrÃ¼fung â€“ blockiert PRs, die in main mergen wollen
      - name: Check if PR targets main
        run: |
          echo "ğŸ” PrÃ¼fe Ziel-Branch..."
          # GitHub-Kontext liefert den Ziel-Branch des Pull Requests
          if [ "${{ github.event.pull_request.base.ref }}" == "main" ]; then
            echo "âŒ Merge in main ist nicht erlaubt!"
            exit 1  # Workflow schlÃ¤gt fehl â†’ roter Status â†’ Merge blockiert
          else
            echo "âœ… Merge-Ziel ist erlaubt."
          fi
