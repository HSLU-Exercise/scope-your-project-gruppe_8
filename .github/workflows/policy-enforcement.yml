# Name des Workflows ‚Äì erscheint in GitHub unter "Actions"
name: Policy Enforcement

# Wann der Workflow starten soll
on:
  # Wird ausgel√∂st, wenn jemand einen Pull Request erstellt oder aktualisiert
  pull_request:
    # Wir reagieren nur auf bestimmte Aktionen am PR
    types: [opened, synchronize, reopened]

# Hier beginnen die Jobs (ein Workflow kann mehrere Jobs enthalten)
jobs:
  # Job-ID: frei w√§hlbarer Name (hier "enforce-policies")
  enforce-policies:
    # Laufzeitumgebung ‚Äì GitHub stellt eine Ubuntu-VM bereit
    runs-on: ubuntu-latest

    # Berechtigungen ‚Äì erlaubt dem Workflow, PRs zu lesen und Status zu setzen
    permissions:
      contents: read
      pull-requests: write

    # Liste der einzelnen Schritte, die in diesem Job ausgef√ºhrt werden
    steps:
      # Schritt 1: Repository-Code laden
      - name: Checkout repository
        uses: actions/checkout@v4  # Offizielle GitHub-Action, l√§dt das Repo

      # Schritt 2: Policy-Pr√ºfung ‚Äì blockiert PRs, die in main mergen wollen
      - name: Check if PR targets main
        run: |
          echo "üîç Pr√ºfe Ziel-Branch..."

          # GitHub-Kontext liefert den Ziel-Branch des Pull Requests
          if [ "${{ github.event.pull_request.base.ref }}" == "main" ]; then
            echo "‚ùå Merge in main ist nicht erlaubt!"
            exit 1  # Workflow schl√§gt fehl ‚Üí roter Status ‚Üí Merge blockiert
          else
            echo "‚úÖ Merge-Ziel ist erlaubt."
          fi
